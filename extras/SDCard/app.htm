<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aquarium Light Control</title>
    <link rel="stylesheet" href="css/app.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <h1>ğŸ  Aquarium Lichtsteuerung</h1>
            <div class="status">
                <span class="status-item">ğŸŒ¡ï¸ <span id="temp">--.-</span>Â°C</span>
                <span class="status-item">ğŸ• <span id="time">--:--:--</span></span>
                <span class="status-item" id="wifiStatus">ğŸ“¶ Verbunden</span>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Macro Active Banner -->
        <div id="macroBanner" class="macro-banner hidden">
            <div class="macro-info">
                <span class="macro-name">ğŸ¬ <span id="macroName">Movie Mode</span></span>
                <span class="macro-timer">â±ï¸ <span id="macroRemaining">--:--</span> verbleibend</span>
            </div>
            <button onclick="stopMacro()" class="btn-stop">â–  Stoppen</button>
        </div>

        <!-- Test Mode Banner -->
        <div id="testBanner" class="test-banner hidden">
            <span>âš¡ Test-Modus aktiv - Schieberegler steuern die Lichter direkt</span>
            <button onclick="exitTestMode()" class="btn-stop">Beenden</button>
        </div>

        <!-- Schedule Chart -->
        <section class="card">
            <div class="card-header">
                <h2>ğŸ“Š Tagesablauf</h2>
                <div class="card-actions">
                    <button onclick="toggleTestMode()" class="btn btn-primary" id="testModeBtn">
                        âš¡ Test-Modus starten
                    </button>
                    <button onclick="saveSchedule()" class="btn btn-success">
                        ğŸ’¾ Zeitplan speichern
                    </button>
                    <button onclick="deleteAllSchedules()" class="btn btn-danger">
                        ğŸ—‘ï¸ Zeitplan lÃ¶schen
                    </button>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="scheduleChart"></canvas>
            </div>
            <div class="chart-legend" id="chartLegend"></div>
        </section>

        <!-- Channel Controls -->
        <section class="card">
            <div class="card-header">
                <h2>ğŸšï¸ Kanal-Steuerung</h2>
                <div class="card-actions">
                    <button onclick="showChannelConfigEditor()" class="btn btn-secondary">
                        âš™ï¸ KanÃ¤le konfigurieren
                    </button>
                    <label class="checkbox-label">
                        <input type="checkbox" id="linkChannels">
                        <span>Alle KanÃ¤le verknÃ¼pfen</span>
                    </label>
                </div>
            </div>
            <div id="channelControls" class="channel-controls"></div>
        </section>

        <!-- Add Target Point -->
        <section class="card">
            <div class="card-header">
                <h2>â• Zeitpunkt hinzufÃ¼gen</h2>
            </div>
            <div class="add-target">
                <div class="form-group">
                    <label>Zeit:</label>
                    <input type="time" id="newTargetTime" value="12:00">
                </div>
                <button onclick="addTargetAtTime()" class="btn btn-primary">
                    Aktuelle Werte zu dieser Zeit speichern
                </button>
            </div>
        </section>

        <!-- Macros -->
        <section class="card">
            <div class="card-header">
                <h2>âš¡ Makros</h2>
                <button onclick="showMacroWizard()" class="btn btn-primary">
                    â• Neues Makro erstellen
                </button>
            </div>
            <div id="macroList" class="macro-list">
                <p class="loading">Lade Makros...</p>
            </div>
        </section>
    </div>

    <!-- Macro Wizard Modal -->
    <div id="macroWizard" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ”§ Makro-Assistent</h2>
                <button onclick="closeMacroWizard()" class="btn-close">Ã—</button>
            </div>

            <!-- Step 1: Name and Duration -->
            <div id="wizardStep1" class="wizard-step">
                <h3>Schritt 1: Name und Dauer</h3>
                <div class="form-group">
                    <label>Makro-Name:</label>
                    <input type="text" id="wizardMacroNameInput" placeholder="z.B. Film-Modus">
                </div>
                <div class="form-group">
                    <label>Dauer:</label>
                    <div class="duration-inputs">
                        <input type="number" id="macroDurationHours" min="0" max="12" value="2">
                        <span>Stunden</span>
                        <input type="number" id="macroDurationMinutes" min="0" max="59" value="0">
                        <span>Minuten</span>
                    </div>
                </div>
                <button onclick="wizardNext()" class="btn btn-primary">Weiter â†’</button>
            </div>

            <!-- Step 2: Edit Schedule -->
            <div id="wizardStep2" class="wizard-step hidden">
                <h3>Schritt 2: Lichtmuster definieren</h3>
                <p class="help-text">
                    Verwenden Sie die Schieberegler, um das Lichtmuster fÃ¼r dieses Makro festzulegen.
                </p>
                <div class="chart-container">
                    <canvas id="macroChart"></canvas>
                </div>
                <div id="macroChannelControls" class="channel-controls"></div>
                <div class="add-target">
                    <div class="form-group">
                        <label>Zeit (MM:SS):</label>
                        <input type="text" id="macroAddTime" value="05:00" placeholder="MM:SS">
                    </div>
                    <button onclick="addMacroTimestamp()" class="btn btn-primary">
                        Aktuelle Werte zu dieser Zeit speichern
                    </button>
                </div>
                <div class="wizard-actions">
                    <button onclick="wizardBack()" class="btn">â† ZurÃ¼ck</button>
                    <button onclick="saveMacro()" class="btn btn-success">ğŸ’¾ Makro speichern</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/config.js"></script>
    <script src="js/api.js"></script>
    <script src="js/chart-manager.js"></script>
    <script src="js/app.js"></script>
</body>

</html>